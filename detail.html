<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Détails de l'offre - LM BANK</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body style="background-color: #f8f9fa;">

    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <div class="brand">LM BANK <span>Recrutement</span></div>
            <a href="index.html" class="nav-btn"><i class="fas fa-arrow-left"></i> Retour aux offres</a>
        </div>
    </nav>

    <div class="container" style="padding-top: 40px; padding-bottom: 60px;">
        <!-- Loading State -->
        <div id="loading" style="text-align: center; padding: 50px;">
            <i class="fas fa-spinner fa-spin fa-3x" style="color: var(--primary);"></i>
            <p style="margin-top: 15px; color: #666;">Chargement des détails...</p>
        </div>

        <!-- Content (Hidden initially) -->
        <div id="job-detail" style="display: none; max-width: 900px; margin: 0 auto;">

            <div class="card" style="padding: 40px; border-top: 5px solid var(--primary);">
                <div
                    style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
                    <div>
                        <span class="badge"
                            style="background: var(--light-blue); color: var(--primary); margin-bottom: 10px; display: inline-block;"
                            id="job-contract">CDI</span>
                        <h1 id="job-title" style="font-size: 2.2rem; color: #333; margin: 5px 0 10px 0;">Titre du poste
                        </h1>
                        <p style="color: #777; font-size: 1.1rem;"><i class="fas fa-map-marker-alt"></i> <span
                                id="job-location">Ville</span> • Publié le <span id="job-date">Date</span></p>
                    </div>
                    <div style="text-align: right;">
                        <a href="#" id="apply-btn-top" class="btn" style="padding: 12px 30px; font-size: 1rem;">Postuler
                            maintenant</a>
                    </div>
                </div>

                <hr style="border: 0; border-top: 1px solid #eee; margin: 30px 0;">

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div style="background: #f9f9f9; padding: 20px; border-radius: 8px;">
                        <h5 style="color: var(--primary); margin-bottom: 10px;"><i class="fas fa-graduation-cap"></i>
                            Niveau Requis</h5>
                        <p id="job-level" style="font-weight: 500; font-size: 1.1rem;">-</p>
                    </div>
                    <div style="background: #f9f9f9; padding: 20px; border-radius: 8px;">
                        <h5 style="color: var(--primary); margin-bottom: 10px;"><i class="fas fa-briefcase"></i>
                            Expérience</h5>
                        <p id="job-exp" style="font-weight: 500; font-size: 1.1rem;">-</p>
                    </div>
                </div>

                <h3 style="margin-bottom: 15px; color: #333;">Description du poste</h3>
                <div id="job-description"
                    style="line-height: 1.8; color: #555; white-space: pre-line; font-size: 1.05rem;">
                    <!-- Description content -->
                </div>

                <div style="margin-top: 50px; text-align: center;">
                    <a href="#" id="apply-btn-bottom" class="btn btn-primary"
                        style="padding: 15px 40px; font-size: 1.2rem; box-shadow: 0 4px 15px rgba(0,86,179,0.3);">
                        <i class="fas fa-paper-plane"></i> Postuler à cette offre
                    </a>
                </div>
            </div>
        </div>

        <!-- Error State -->
        <div id="error-msg" style="display: none; text-align: center; padding: 50px; color: #dc3545;">
            <i class="fas fa-exclamation-circle fa-3x"></i>
            <h3 style="margin-top: 15px;">Offre introuvable</h3>
            <p>Cette offre n'existe plus ou le lien est incorrect.</p>
            <a href="index.html" class="btn" style="margin-top: 20px;">Retour aux offres</a>
        </div>
    </div>

    <!-- Footer -->
    <footer
        style="background: var(--text-primary); color: white; padding: 30px 0; text-align: center; margin-top: auto;">
        <p>© 2025 LM BANK Recrutement</p>
    </footer>

    <script>
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx3WrOoWoaWnHqzZKqOZb4RI5eZGnEi09h_tB2wcISC7WC8AmlyLhj3dy08TyM1kWfd1w/exec';

        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');

            if (!id) {
                showError();
                return;
            }

            try {
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=getOffers`);
                const jobs = await response.json();

                // Find the job by ID
                const job = jobs.find(j => j.id === id);

                if (job) {
                    displayJob(job);
                } else {
                    showError();
                }

            } catch (error) {
                console.error("Error", error);
                showError();
            }
        });

        function displayJob(job) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('job-detail').style.display = 'block';

            document.getElementById('job-title').textContent = job.title;
            document.getElementById('job-location').textContent = job.location;

            // Format Date
            let dateDisplay = job.date;
            try {
                const d = new Date(job.date);
                if (!isNaN(d.getTime())) dateDisplay = d.toLocaleDateString('fr-FR');
            } catch (e) { }
            document.getElementById('job-date').textContent = dateDisplay;

            document.getElementById('job-contract').textContent = job.contract;
            document.getElementById('job-level').textContent = job.level || "Non spécifié";
            document.getElementById('job-exp').textContent = (job.desc.match(/Expérience.*?(\d+.*?ans?)/i) || [])[1] || "Selon profil"; // Try to extract exp or show default

            // Handle description line breaks
            document.getElementById('job-description').textContent = job.desc;

            // Link Apply Buttons
            const links = `formulaire.html?job=${encodeURIComponent(job.title)}`;
            document.getElementById('apply-btn-top').href = links;
            document.getElementById('apply-btn-bottom').href = links;
        }

        function showError() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error-msg').style.display = 'block';
        }
    </script>
</body>

</html>