<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>G√©n√©rateur x42 - LM BANK</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #e9ecef;
            margin: 0;
        }

        .card {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 500px;
        }

        .btn {
            background: #6610f2;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            width: 100%;
            transition: 0.3s;
            margin-top: 20px;
        }

        .btn:hover {
            background: #520dc2;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        #progress-container {
            margin-top: 25px;
            background: #e9ecef;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            display: none;
        }

        #progress-bar {
            width: 0%;
            height: 100%;
            background: #6610f2;
            transition: width 0.3s;
        }

        #status {
            margin-top: 15px;
            color: #666;
            font-size: 0.95rem;
            font-weight: 500;
        }
    </style>
</head>

<body>
    <div class="card">
        <h2>üöÄ G√©n√©rateur de Masse (x42)</h2>
        <p style="color: #6c757d; line-height: 1.6;">Cliquez g√©n√©rer exactement <strong>42 offres d'emploi</strong>
            professionnelles (M√©lange al√©atoire de villes et contrats).</p>

        <button id="start-btn" class="btn" onclick="startMassSeeding()">Lancer la G√©n√©ration (x42)</button>

        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>
        <p id="status"></p>
        <a href="index.html" id="done-link"
            style="display: none; margin-top: 25px; color: #6610f2; text-decoration: none; font-weight: bold; font-size: 1.1rem;">Voir
            les 42 offres &rarr;</a>
    </div>

    <script>
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxzyPbq9-HeZJ__IYOlvvCbd53ecF-a0PnVgh8VDHL5zrsBRdFmc3RslDBgWMMNL71Q/exec';

        const cities = ["Casablanca", "Rabat", "Marrakech", "Tanger", "Agadir", "F√®s", "Oujda", "Mekn√®s", "La√¢youne"];
        const contracts = ["CDI", "CDD", "Freelance", "Stage"];

        // BASE TEMPLATES (Pro Descriptions)
        const jobTemplates = [
            { title: "Conseiller Client√®le Particuliers", level: "Bac+3", exp: "2 ans", desc: "MISSIONS PRINCIPALES :\n‚Ä¢ Accueillir et conseiller la client√®le.\n‚Ä¢ Vendre les produits bancaires.\n‚Ä¢ G√©rer les op√©rations courantes.\n\nPROFIL :\n‚Ä¢ Bac+3 Commerce/Banque.\n‚Ä¢ Sens de l'√©coute." },
            { title: "Charg√© d'Affaires Entreprises", level: "Bac+5", exp: "4 ans", desc: "MISSIONS :\n‚Ä¢ G√©rer un portefeuille Entreprises.\n‚Ä¢ Proposer des solutions de financement.\n‚Ä¢ Analyse financi√®re approfondie.\n\nPROFIL :\n‚Ä¢ Ecole de Commerce.\n‚Ä¢ 4 ans d'exp√©rience." },
            { title: "Chef de Projet Digital", level: "Ing√©nieur", exp: "5 ans", desc: "MISSIONS :\n‚Ä¢ Piloter les projets mobiles.\n‚Ä¢ Coordonner les √©quipes Dev & UX.\n‚Ä¢ Suivi KPI et budget.\n\nPROFIL :\n‚Ä¢ Ing√©nieur Informatique.\n‚Ä¢ Exp√©rience Agile." },
            { title: "Analyste Risques", level: "Bac+5", exp: "3 ans", desc: "MISSIONS :\n‚Ä¢ Analyser les demandes de cr√©dit.\n‚Ä¢ Evaluer les risques.\n‚Ä¢ R√©daction des comit√©s.\n\nPROFIL :\n‚Ä¢ Finance / Audit.\n‚Ä¢ Rigueur." },
            { title: "Directeur d'Agence", level: "Master", exp: "7 ans", desc: "MISSIONS :\n‚Ä¢ Pilotage du centre de profit.\n‚Ä¢ Management √©quipe.\n‚Ä¢ Repr√©sentation locale.\n\nPROFIL :\n‚Ä¢ Bac+5 confirm√©\n‚Ä¢ Leadership." },
            { title: "D√©veloppeur Fullstack", level: "Ing√©nieur", exp: "3 ans", desc: "MISSIONS :\n‚Ä¢ D√©veloppement Java/Angular.\n‚Ä¢ Maintenance des APIs.\n‚Ä¢ Code Review.\n\nPROFIL :\n‚Ä¢ Passionn√© tech.\n‚Ä¢ Autonome." },
            { title: "Auditeur Interne", level: "Bac+5", exp: "5 ans", desc: "MISSIONS :\n‚Ä¢ Missions de contr√¥le.\n‚Ä¢ V√©rification conformit√©.\n‚Ä¢ Rapports d'audit.\n\nPROFIL :\n‚Ä¢ Big 4 ou Audit bancaire." },
            { title: "Guichetier / Accueil", level: "Bac+2", exp: "D√©butant", desc: "MISSIONS :\n‚Ä¢ Op√©rations de caisse.\n‚Ä¢ Orientation client.\n\nPROFIL :\n‚Ä¢ Bac+2 Gestion.\n‚Ä¢ Bonne pr√©sentation." },
            { title: "Expert S√©curit√© SI", level: "Ing√©nieur", exp: "5 ans", desc: "MISSIONS :\n‚Ä¢ Politique s√©curit√©.\n‚Ä¢ Gestion incidents SOC.\n‚Ä¢ Tests intrusion.\n\nPROFIL :\n‚Ä¢ Certifications CISSP/CEH." },
            { title: "Juriste Contentieux", level: "Master Droit", exp: "4 ans", desc: "MISSIONS :\n‚Ä¢ Recouvrement judiciaire.\n‚Ä¢ Gestion avocats.\n‚Ä¢ N√©gociation.\n\nPROFIL :\n‚Ä¢ Droit des affaires." }
        ];

        async function startMassSeeding() {
            const btn = document.getElementById('start-btn');
            const status = document.getElementById('status');
            const bar = document.getElementById('progress-bar');
            const container = document.getElementById('progress-container');

            btn.disabled = true;
            btn.textContent = "G√©n√©ration de 42 offres...";
            container.style.display = 'block';

            let count = 0;
            const target = 42;

            for (let i = 0; i < target; i++) {
                // 1. Pick Random Template
                const template = jobTemplates[Math.floor(Math.random() * jobTemplates.length)];

                // 2. Randomize City & Contract
                const randomCity = cities[Math.floor(Math.random() * cities.length)];
                const randomContract = contracts[Math.floor(Math.random() * contracts.length)];

                const payload = {
                    action: 'add_offer',
                    titre: template.title,
                    ville: randomCity,
                    contrat: randomContract,
                    niveau_requis: template.level,
                    experience_requise: template.exp,
                    description: template.desc + `\n\n(Offre g√©n√©r√©e pour ${randomCity})`
                };

                try {
                    // Using text/plain prevents CORS preflight issues while still sending JSON string
                    // Google Apps Script can parse this perfectly
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                        body: JSON.stringify(payload)
                    });

                    count++;
                    const pct = Math.round((count / target) * 100);
                    bar.style.width = pct + "%";
                    status.textContent = `Offre ${count}/42 : ${payload.titre} √† ${payload.ville}`;

                } catch (e) {
                    console.error("Erreur avec l'offre", count, e);
                }

                // Increased delay to 1.5s to play nice with Google quotas
                await new Promise(r => setTimeout(r, 1500));
            }

            btn.textContent = "‚úÖ C'est fait !";
            status.textContent = "42 Nouvelles offres ajout√©es.";
            document.getElementById('done-link').style.display = 'inline-block';
        }
    </script>
</body>

</html>